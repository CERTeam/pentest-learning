# 渗透入门第五周

前几周了解了基本的语言以及HTTP的概念，现在主要来了解一下常见Web环境，最后有两个基础性的任务。

## 0x01 前言

进攻一个目标的前提是首先你要了解对方，从Web端渗透首先需要了解Web开发，运维。这样遇到各种环境才能游刃有余。先介绍一下中小型渗透项目的Web环境。

小公司一般会使用阿里云、腾讯云、亚马逊等云服务。结构最简单的那种就是通过几个域名，解析在一台服务器，Apache或者Nginx作为前端服务器，也可以不使用。JSP、PHP、ASP.NET等后端服务都跑在上面，还运行着数据库、文件服务器等。只要通过其他服务漏洞拿下那一台就够了。

结构复杂一点的就是把HTTP服务，DB服务，文件服务，Web后端服务进行分离，运行在不同服务器。这些服务器属于一个组，在同一个局域网或者VPN。

中小型企业一般会有自己的机房和公网IP段，一般分布在一个C段。有的Web服务会使用CDN、负载均衡、虚拟IP等运维技术，增加渗透的复杂度。但是可能存在技术人员水平参差不齐，存在孤岛主机等管理问题。中小型企业一般都会采购安全服务，那么肯定会有一些安全产品，WAF/IDS/IPS/FW等，如果遇到良心的安服，那可能会被应急响应。

Web环境众多，结构也非常多。比如请求一个网站，首先通过域名解析获取IP，有可能网站加了CDN，那么要绕过CDN。绕过之后可能访问的还是一个HTTP服务器，如Nginx、Apache等。一般用HTTP服务器代理后端的应用程序，可能使用fastcgi转发给后端服务程序，如php-fpm，WSGIServer等。或者直接转发到后端服务端口。HTTP服务器可能会负责一些文件后缀的解析，比如匹配到图片格式则转发到图床，匹配到脚本文件则转发到解析器。可能会遇到负载均衡的情况，有可能你上传了一个shell之后，再次访问就404了。或者如果你拿到HTTP服务器的权限，可能遇到虚拟IP的情况，这时候又会一头雾水。

当前面的东西都搞定之后，应该就进入真正运行的服务器了。接下来就是getshell,一般意义的getshell就是通过上传ASP、ASP.NET、JSP、PHP等脚本文件然后解析获取代码执行权限。NodeJS，Python非解析型的很少会出现这种情况，其他形式执行代码的情况以后会提到。

后端可能会是IIS、PHP、JSP、Servlet等环境。不同的环境，执行流程，配置文件都不同，如何添加后门，如何找到数据库都是需要考虑的。其中Java系的环境最为复杂，从Web容器到应用服务器，如Tomcat，Jetty，Resin，JBoss，Weblogic，WebSphere等。需要了解非常多的开发知识，有的企业会用到微服务架构，又会涉及到更多的技术。

如何找到配置信息，如何篡改文件，如何使用目标服务都需要大量的知识储备。希望你们理解Web环境中每一层的作用，意义。以及一些细节，比如Nginx是如何让PHP解析脚本的，其中会经过哪些处理。Java Web容器的概念，应用服务器的概念，这些区别与包含关系都要弄清楚。

## 0x02 实践

我感觉要求可能太高了，我会放慢进度。

### 尝试Maven

上周学习了Java基础，这周要求使用Maven或者Gradle在IDEA创建一个Web项目，搭建Struts2的开发环境，写一个HelloWorld，构建项目并生成WAR包。要求访问一个页面使用Apache Tomcat 8运行。
会遇到Maven仓库问题，要学会怎么配置Maven仓库。其中学会给IDEA配置代理，让Maven通过代理下载Jar包或者源码。
学会配置依赖(包括手动配置与使用IDEA配置)，了解Maven和Gradle的配置文件，理解它们的区别，熟悉命令行下mvn和gradle的命令。

仓库推荐 - [MVN Repository](http://mvnrepository.com/)

### 使用Git

[Git 教程 - 廖雪峰](https://www.liaoxuefeng.com)

要求全程使用命令行操作，以协作者的身份加入项目，首先clone我的pentest-learning仓库，最后每个人在本地仓库新建一个以自己id为名的分支，在本地的项目新建一个文件夹homework，在homework目录新建以自己id命名的文件夹。将上述IDEA的项目复制到此文件夹，提交到本地仓库，同步到远程仓库，最后把自己项目合并到master分支。